---
import Header from "@/components/Header.astro"
import ProfileCard from "@/components/io-extended-25/ProfileCard"
import BaseLayout from "@/layout/BaseLayout.astro"
import { getProfile } from "@/lib/services/profileService"
import { getEventRegistration } from "@/lib/services/registrationService"
import { createUserClient } from "@/lib/supabase"
const supabase = await createUserClient(Astro.cookies)
const profile = await getProfile(supabase)
if (!profile) return Astro.redirect("/")

const registration = await getEventRegistration(supabase, profile?.id, Astro.params.eventSlug || "")

const {
  data: { user },
} = await supabase.auth.getUser()

const avatarUrl = user?.user_metadata?.avatar_url || null
const userName = user?.user_metadata?.full_name || user?.email || "Usuario"
const userInitial = userName.charAt(0).toUpperCase()

if (!registration || registration?.status !== "confirmed") return Astro.redirect("/")
---

<BaseLayout>
    <Header />
    <main class="mt-16 pt-12 flex">
        <div class="mx-auto px-4">
            <!-- <h1 class="text-xl mb-4">¡Hola, {profile?.first_name}!</h1>
      <p>
        ¡Felicidades! Tu registro ya fue validado, revisa tu correo electrónico.
        <br />
        Mientras esperas, te invitamos a nuestra
        <a
          href="https://chat.whatsapp.com/EHtkjWuuhPh8cPDY8U9A7O"
          class="text-green-500 font-medium underline">Comunidad en WhatsApp</a
        >
      </p> -->
            <!-- <div class="min-h-screen bg-black pt-20"> -->
            <ProfileCard
                client:load
                name={userName}
                title={`${profile?.id || "Participante"}`}
                handle={`${profile?.email}`}
                status=""
                contactText="Contact"
                miniAvatarUrl={avatarUrl}
                avatarUrl={avatarUrl}
                showUserInfo={true}
                enableTilt={true}
                enableMobileTilt={false}
                iconUrl="/favicon.svg"
                grainUrl="/favicon.svg"
                onContactClick={() => console.log("Contact clicked")}
            />
            <!-- </div> -->
        </div>
    </main>
</BaseLayout>
