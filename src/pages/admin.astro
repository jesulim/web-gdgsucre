---
import { Dashboard } from "@/components/admin/Dashboard.tsx"

import BaseLayout from "@/layout/BaseLayout.astro"
import { getProfile } from "@/lib/services/profileService"
import { createUserClient } from "@/lib/supabase"

const supabase = await createUserClient(Astro.cookies)
const profile = await getProfile(supabase)

if (!profile?.is_admin) {
  return Astro.redirect("/")
}

const userData = {
  name: `${profile.first_name} ${profile.last_name}`.trim(),
  email: profile.email,
  avatar: profile.avatar_url,
}
---

<BaseLayout title="Admin GDG Sucre">
  <Dashboard client:only="react" userData={userData} />
</BaseLayout>
