---
import { hasRegistration } from "@/lib/services/registrationService"
import { createUserClient } from "@/lib/supabase"

const accessToken = Astro.cookies.get("sb-access-token")?.value
let redirectHref = accessToken
  ? "/registro/devfest-25"
  : "/api/auth/signin?next=/registro/devfest-25"

let registration = false
if (accessToken) {
  const supabase = await createUserClient(Astro.cookies)
  const {
    data: { claims },
  } = await supabase.auth.getClaims(accessToken)
  registration = await hasRegistration(supabase, claims?.sub, "devfest-25")
  redirectHref = "/registro/devfest-25/confirmado"
}
---

<a href={redirectHref}>
  {!registration ? "Reg√≠strate ahora" : "Ver credencial"}
</a>
